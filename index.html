<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Turn-Based Beta + Story + BGM</title>
<style>
body{margin:0;padding:24px;background:#0f172a;color:#e5e7eb;font-family:"Sarabun",sans-serif;}
.app{max-width:900px;margin:auto;display:grid;gap:16px}
.panel{background:rgba(255,255,255,.05);padding:16px;border-radius:16px}
button{padding:10px 14px;border:none;border-radius:10px;background:#1e293b;color:white;cursor:pointer}
button:hover{background:#2563eb}
.btns{display:flex;gap:8px;flex-wrap:wrap}
.log{max-height:180px;overflow:auto;font-size:14px}
.hpbar{height:14px;background:#1f2937;border-radius:8px;overflow:hidden;margin:6px 0}
.hpbar>div{height:100%;background:linear-gradient(90deg,#4ade80,#fbbf24,#f87171)}
.sprite{width:160px;max-height:200px}
.slot{display:flex;flex-direction:column;align-items:center}
.arena{display:flex;justify-content:space-between;align-items:flex-end;min-height:300px}
.storybox{background:rgba(15,23,42,.9);border:1px solid rgba(255,255,255,.1);
padding:16px;border-radius:14px;margin-bottom:12px;line-height:1.6}
</style>
</head>
<body>
<div class="app">
<h2>üéÆ Turn-Based RPG + ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á + ‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</h2>

<!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
<div id="story" class="storybox">
  <b id="speaker">Player:</b>
  <span id="dialogue">‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‚Ä¶</span><br>
  <button id="next">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂Ô∏è</button>
</div>

<!-- ‡∏™‡∏ô‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ -->
<div class="arena">
  <div class="slot">
    <strong id="pName">Player</strong>
    <div class="hpbar"><div id="pHP" style="width:100%"></div></div>
    <img src="Player.png" class="sprite">
  </div>
  <div class="slot">
    <strong id="eName">Monster</strong>
    <div class="hpbar"><div id="eHP" style="width:100%"></div></div>
    <img src="Monster.png" class="sprite" style="transform:scaleX(-1)">
  </div>
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
<div class="panel">
  <div class="btns">
    <button id="attack">‡πÇ‡∏à‡∏°‡∏ï‡∏µ (A)</button>
    <button id="defend">‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (D)</button>
    <button id="skill">‡∏™‡∏Å‡∏¥‡∏•‡πÑ‡∏ü (S)</button>
    <button id="reset">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (R)</button>
    <button id="bgmBtn">üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á</button>
  </div>
  <div class="log" id="log"></div>
</div>
</div>

<!-- ‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á -->
<audio id="bgm" src="bgm.mp3" loop preload="auto" playsinline></audio>

<script>
// ---------- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ----------
const storyText = [
  {s:'Player', t:'‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‚Ä¶'},
  {s:'Monster', t:'‡∏Å‡∏£‡πà‡∏≠‡∏£‡πå! ‡πÄ‡∏à‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≤‡∏ö‡∏∏‡∏Å‡∏£‡∏∏‡∏Å‡∏ñ‡πâ‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡πÄ‡∏´‡∏£‡∏≠!'},
  {s:'Player', t:'‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏π‡πâ‡πÅ‡∏•‡πâ‡∏ß!'},
  {cmd:'battle'},
  {s:'Player', t:'‡πÄ‡∏¢‡πâ! ‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß‚Ä¶ ‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!'}
];
let storyIndex = 0;
const storyBox = document.getElementById("story");
const speaker = document.getElementById("speaker");
const dialogue = document.getElementById("dialogue");
const nextBtn = document.getElementById("next");

function nextStory(){
  const n = storyText[storyIndex];
  if(!n) return;
  if(n.cmd==="battle"){ storyBox.style.display="none"; startBattle(); return; }
  speaker.textContent = n.s+":";
  dialogue.textContent = n.t;
  storyIndex++;
}
nextBtn.onclick = nextStory;

// ---------- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ ----------
let playerHP = 100, enemyHP = 100;
let turn = "player";
const log = document.getElementById("log");
function addLog(msg){ log.innerHTML += msg+"<br>"; log.scrollTop = log.scrollHeight; }

function updateHP(){
  document.getElementById("pHP").style.width = playerHP+"%";
  document.getElementById("eHP").style.width = enemyHP+"%";
}

function startBattle(){
  addLog("<b>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ!</b>");
  turn="player";
}

function attack(){
  if(turn!=="player") return;
  const dmg = Math.floor(Math.random()*10)+5;
  enemyHP = Math.max(0, enemyHP - dmg);
  addLog("üó° Player ‡πÇ‡∏à‡∏°‡∏ï‡∏µ Monster ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ "+dmg);
  updateHP();
  if(enemyHP<=0){ addLog("<b>‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!</b>"); bgmPlay(); return; }
  turn="enemy"; setTimeout(enemyTurn,800);
}
function defend(){
  if(turn!=="player") return;
  addLog("üõ° Player ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏±‡∏ö ‡∏•‡∏î‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ");
  playerDef=true; turn="enemy"; setTimeout(enemyTurn,800);
}
function skill(){
  if(turn!=="player") return;
  const dmg = Math.floor(Math.random()*20)+10;
  enemyHP = Math.max(0, enemyHP - dmg);
  addLog("üî• Player ‡πÉ‡∏ä‡πâ‡∏™‡∏Å‡∏¥‡∏•‡πÑ‡∏ü! ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ "+dmg);
  updateHP();
  if(enemyHP<=0){ addLog("<b>‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!</b>"); bgmPlay(); return; }
  turn="enemy"; setTimeout(enemyTurn,800);
}
let playerDef=false;
function enemyTurn(){
  const dmg = Math.floor(Math.random()*12)+5;
  let real = playerDef? Math.floor(dmg/2): dmg;
  playerHP = Math.max(0, playerHP - real);
  addLog("üíÄ Monster ‡πÇ‡∏à‡∏°‡∏ï‡∏µ! Player ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ "+real);
  playerDef=false; updateHP();
  if(playerHP<=0){ addLog("<b>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ...</b>"); bgmPause(); return; }
  turn="player";
}
function reset(){
  playerHP=enemyHP=100; updateHP(); log.innerHTML="";
  storyIndex=0; storyBox.style.display="block"; nextStory();
}
document.getElementById("attack").onclick=attack;
document.getElementById("defend").onclick=defend;
document.getElementById("skill").onclick=skill;
document.getElementById("reset").onclick=reset;

// ---------- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î ----------
window.addEventListener("keydown",e=>{
  const k=e.key.toLowerCase();
  if(k==='a')attack();
  if(k==='d')defend();
  if(k==='s')skill();
  if(k==='r')reset();
  if(k===' ')nextStory();
});

// ---------- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ----------
const bgm=document.getElementById("bgm");
const bgmBtn=document.getElementById("bgmBtn");
function bgmPlay(){
  bgm.volume=0.5; bgm.muted=false;
  bgm.play().then(()=>{bgmBtn.textContent='üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á';})
             .catch(()=>{console.log('Autoplay ‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á');});
}
function bgmPause(){ bgm.pause(); bgmBtn.textContent='üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á'; }
bgmBtn.onclick=()=>{ bgm.paused?bgmPlay():bgmPause(); };

// ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡∏∞/‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
["click","touchstart","keydown"].forEach(ev=>{
  window.addEventListener(ev,()=>{ if(bgm.paused) bgmPlay(); },{once:true});
});

updateHP();
nextStory();
</script>
</body>
</html>
